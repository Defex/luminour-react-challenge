(this["webpackJsonpluminour-react-challenge"]=this["webpackJsonpluminour-react-challenge"]||[]).push([[8],{155:function(e,t,n){"use strict";var r=n(10),a=n.n(r),c=n(16),u=n(36),o=n(13),i=n(30),s=function(){return JSON.parse(localStorage.getItem("carts")||"[]")},l=function(){var e=Object(c.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.l)(100);case 2:return n=s().find((function(e){return e.userId===t}))||{items:[]},e.abrupt("return",n.items);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),f=function(){var e=Object(c.a)(a.a.mark((function e(t,n){var r,c,u,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s(),c={userId:t,items:n},u=[],(i=r.find((function(e){return e.userId===t})))||(u=[].concat(Object(o.a)(r),[c])),i&&(u=r.map((function(e){return e.userId===t?c:e}))),a=u,localStorage.setItem("carts",JSON.stringify(a)),e.abrupt("return",c);case 8:case"end":return e.stop()}var a}),e)})));return function(t,n){return e.apply(this,arguments)}}();n.d(t,"a",(function(){return m})),n.d(t,"b",(function(){return v}));var d=function(e){return{type:u.a.setItems,payload:{items:e}}},p=function(){return{type:u.a.fetchStart}},b=function(e){return{type:u.a.fetchEnd,payload:{errorMessage:e}}},m=function(e){return function(){var t=Object(c.a)(a.a.mark((function t(n){var r;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n(p()),t.prev=1,t.next=4,l(e);case 4:r=t.sent,n(d(r)),n(b()),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(1),console.log(t.t0),n(b());case 13:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(e){return t.apply(this,arguments)}}()},v=function(e,t){return function(){var n=Object(c.a)(a.a.mark((function n(r){return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r(p()),n.prev=1,n.next=4,f(e,t);case 4:r(d(t)),r(b()),n.next=12;break;case 8:n.prev=8,n.t0=n.catch(1),console.log(n.t0),r(b(n.t0.message));case 12:case"end":return n.stop()}}),n,null,[[1,8]])})));return function(e){return n.apply(this,arguments)}}()}},156:function(e,t,n){"use strict";var r=n(45),a=n(0),c=n(26),u=n(10),o=n.n(u),i=n(16),s=n(37),l=n(30),f=Object(l.c)("books"),d=f.getItems,p=f.createItems,b=f.updateItems,m=f.deleteItems,v=p,O=Object(l.k)(b),j=Object(l.k)(m),h=function(e){return{type:s.a.setBooks,payload:{books:e}}},y=function(e){return{type:s.a.updateBooks,payload:{books:e}}},k=function(e){return{type:s.a.deleteBooks,payload:{books:e}}},E=function(){return{type:s.a.fetchStart}},g=function(e){return{type:s.a.fetchEnd,payload:{errorMessage:e}}},x=n(49);n.d(t,"b",(function(){return w})),n.d(t,"a",(function(){return C}));var w=function(e){var t=Object(a.useState)(!e),n=Object(r.a)(t,2),u=n[0],s=n[1],f=Object(c.b)(),p=Object(c.c)((function(e){return e.books})),b=p.books,m=p.loading,O=p.hasLoaded,j=p.errorMessage;return Object(a.useEffect)((function(){O&&u||m||(s(!0),f(function(){var e=Object(i.a)(o.a.mark((function e(t){var n,r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t(E()),e.prev=1,e.next=4,d();case 4:if(0!==(n=e.sent).length){e.next=14;break}return e.next=8,Object(l.f)();case 8:return r=e.sent,e.next=11,v(r);case 11:return a=e.sent,t(h(a)),e.abrupt("return",t(g()));case 14:n.length>0&&(t(h(n)),t(g())),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(1),console.log(e.t0),t(g(e.t0.message));case 21:case"end":return e.stop()}}),e,null,[[1,17]])})));return function(t){return e.apply(this,arguments)}}()))}),[O,m,e,f,u]),{books:b,loading:m,hasLoaded:O,errorMessage:j}},C=function(){var e=Object(c.b)(),t=Object(x.b)().me;return{addBooks:function(t){return e(function(e){return function(){var t=Object(i.a)(o.a.mark((function t(n){var r;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n(E()),t.prev=1,t.next=4,v(e);case 4:r=t.sent,n(h(r)),n(g()),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(1),console.log(t.t0),n(g(t.t0.message));case 13:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(e){return t.apply(this,arguments)}}()}(t))},deleteBooks:function(n){return t&&e(function(e,t){return function(){var n=Object(i.a)(o.a.mark((function n(r){var a;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r(E()),n.prev=1,n.next=4,j(e,t.map((function(e){return e.id})));case 4:a=n.sent,r(k(a)),r(g()),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(1),console.log(n.t0),r(g(n.t0.message));case 13:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(e){return n.apply(this,arguments)}}()}(t,n))},updateBooks:function(n){return t&&e(function(e,t){return function(){var n=Object(i.a)(o.a.mark((function n(r){var a;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r(E()),n.prev=1,n.next=4,O(e,t);case 4:a=n.sent,r(y(a)),r(g()),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(1),console.log(n.t0),r(g(n.t0.message));case 13:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(e){return n.apply(this,arguments)}}()}(t,n))}}}},157:function(e,t,n){"use strict";var r=n(45),a=n(6),c=n(26),u=n(56),o=n(10),i=n.n(o),s=n(16),l=n(18),f=n(30),d=Object(f.c)("orders"),p=d.getItems,b=d.createItems,m=d.updateItems,v=p,O=b,j=m,h=function(){var e=Object(s.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v();case 2:return n=e.sent,e.abrupt("return",n.filter((function(e){return e.buyer.id===t})));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=n(155),k=function(e){return{type:l.a.setOrders,payload:{orders:e}}},E=function(e){return{type:l.a.updateOrders,payload:{orders:e}}},g=function(){return{type:l.a.fetchStart}},x=function(){return{type:l.a.fetchEnd}},w=function(e){return function(){var t=Object(s.a)(i.a.mark((function t(n){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n(g()),t.prev=1,t.next=4,h(e);case 4:r=t.sent,n(k(r)),n(x()),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(1),console.log(t.t0),n(x());case 13:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(e){return t.apply(this,arguments)}}()},C=function(e){return function(){var t=Object(s.a)(i.a.mark((function t(n){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n(g()),t.prev=1,t.next=4,j(e);case 4:n(E(e)),n(x()),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(1),console.log(t.t0),n(x());case 12:case"end":return t.stop()}}),t,null,[[1,8]])})));return function(e){return t.apply(this,arguments)}}()},I=n(49),S=n(0);n.d(t,"d",(function(){return q})),n.d(t,"c",(function(){return B})),n.d(t,"a",(function(){return L})),n.d(t,"b",(function(){return A}));var q=function(){return Object(c.c)((function(e){return e.orders}))},B=function(){var e=Object(c.b)();return{createOrder:function(t,n){return e((r={id:Object(u.uuid)(),buyer:{id:t.id,name:t.name,surname:t.surname,username:t.username},status:l.b.new,items:n},function(){var e=Object(s.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t(g()),e.prev=1,e.next=4,O([r]);case 4:n=e.sent,t(k(n)),t(Object(y.b)(r.buyer.id,[])),t(x()),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),console.log(e.t0),t(x());case 14:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}()));var r},confirmOrder:function(t){return e(C([Object(a.a)({},t,{status:l.b.paid})]))},cancelOrder:function(t){return e(C([Object(a.a)({},t,{status:l.b.canceled})]))},updateOrder:function(t){return e(C([t]))}}},L=function(){var e=Object(c.b)(),t=Object(I.b)(),n=Object(c.c)((function(e){return e.orders}));return Object(S.useEffect)((function(){!n.hasLoaded&&!n.loading&&t.me&&t.me.id&&e(w(t.me.id))})),Object(a.a)({},n,{loading:t.loading||n.loading})},A=function(e){var t=Object(S.useState)(!1),n=Object(r.a)(t,2),a=n[0],u=n[1],o=Object(c.b)(),i=Object(c.c)((function(e){return e.orders})),s=i.orders,l=i.loading,f=i.hasLoaded;return Object(S.useEffect)((function(){!e||a||l||(u(!0),o(w(e)))}),[e,l,o,a]),{orders:s,loading:l,hasLoaded:f}}},159:function(e,t,n){"use strict";var r=n(45),a=n(0),c=n.n(a),u=n(145),o=n(181),i=n(144),s=n(170),l=n(171),f=n(182),d=n(172),p=n(156);t.a=function(e){var t=e.handleAddToCartClick,n=Object(a.useState)(!1),b=Object(r.a)(n,2),m=b[0],v=b[1],O=Object(p.b)(!0).books;return c.a.createElement("div",null,c.a.createElement(u.a,{onClick:function(){return v(!0)},variant:"contained"},"Add Item"),c.a.createElement(o.a,{open:m,onClose:function(){return v(!1)}},c.a.createElement(i.a,null,O.map((function(e){return c.a.createElement(s.a,{key:"".concat(e.id),divider:!0},c.a.createElement(l.a,null,c.a.createElement(f.a,{alt:e.title,src:e.book_cover,variant:"square"})),c.a.createElement(d.a,{primary:e.title}),c.a.createElement(d.a,{secondary:e.author}),c.a.createElement(d.a,{secondary:e.published_date}),c.a.createElement("div",null,c.a.createElement(u.a,{onClick:(n=e,function(){return t(n)()})},"Add To Cart")));var n})))))}},176:function(e,t,n){"use strict";n.r(t);var r=n(13),a=n(6),c=n(0),u=n.n(c),o=n(20),i=n(46),s=n(143),l=n(145),f=n(144),d=n(170),p=n(171),b=n(182),m=n(172),v=n(166),O=n(157),j=n(30),h=n(49),y=n(18),k=n(159);t.default=function(){var e=Object(o.f)().push,t=Object(o.h)().orderId,n=Object(O.a)(),c=n.orders,E=n.loading,g=Object(O.c)().updateOrder,x=Object(h.b)().me,w=c.find((function(e){return e.id===t})),C=x&&x.role&&w&&Object(j.e)(x.role,w.status)||!1,I=function(e){return function(){if(w){var t=w&&w.items.find((function(t){return t.id===e.id}));if(t){var n=Object(a.a)({},t,{quantity:t.quantity+1}),c=w.items.map((function(e){return e.id===t.id?n:e}));return g(Object(a.a)({},w,{items:c}))}return g(Object(a.a)({},w,{items:[].concat(Object(r.a)(w.items),[Object(a.a)({},e,{quantity:1})])}))}}},S=function(e){return function(){if(w){var t=w&&w.items.find((function(t){return t.id===e.id}));if(t&&t.quantity>1){var n=Object(a.a)({},t,{quantity:t.quantity-1}),r=w.items.map((function(e){return e.id===t.id?n:e}));return g(Object(a.a)({},w,{items:r}))}return g(Object(a.a)({},w,{items:w.items.filter((function(t){return t.id!==e.id}))}))}}},q=function(e){return function(){if(w)return g(Object(a.a)({},w,{items:w.items.filter((function(t){return t.id!==e.id}))}))}},B=function(){return w&&g(Object(a.a)({},w,{status:y.b.canceled}))};return u.a.createElement("div",null,E&&u.a.createElement(s.a,null),!E&&w&&u.a.createElement("div",null,u.a.createElement(l.a,{onClick:function(){return e(i.a["/my-orders"].href())}},"Go Back"),u.a.createElement("div",null,u.a.createElement("span",null,"Order id:"),u.a.createElement("span",null,w.id)),u.a.createElement("div",null,u.a.createElement("span",null,"Order status:"),u.a.createElement("span",null,w.status)),w.status===y.b.new&&u.a.createElement(k.a,{handleAddToCartClick:I}),u.a.createElement("div",null,u.a.createElement("div",null,"Order Items"),u.a.createElement(f.a,null,w.items.map((function(e){return u.a.createElement(d.a,{key:"".concat(e.id),divider:!0},u.a.createElement(p.a,null,u.a.createElement(b.a,{alt:e.title,src:e.book_cover,variant:"square"})),u.a.createElement(m.a,{primary:e.title}),u.a.createElement(m.a,{secondary:e.author}),u.a.createElement(m.a,{secondary:e.published_date}),u.a.createElement("div",null,w.status===y.b.new&&u.a.createElement(l.a,{onClick:S(e)},"<"),u.a.createElement("span",null,"Quantity: ".concat(e.quantity)),w.status===y.b.new&&u.a.createElement(l.a,{onClick:I(e)},">")),u.a.createElement("div",null,w.status===y.b.new&&u.a.createElement(l.a,{onClick:q(e)},"Remove")))}))),C&&u.a.createElement(v.a,{container:!0,justify:"flex-end"},C[y.b.canceled]&&u.a.createElement(l.a,{onClick:B,color:"secondary"},"Cancel Order"),C[y.b.sent]&&u.a.createElement(l.a,{onClick:B,color:"primary"},"set sent status"),C[y.b.paid]&&u.a.createElement(l.a,{onClick:function(){return w&&g(Object(a.a)({},w,{status:y.b.paid}))},color:"primary"},"Confirm Order")))))}}}]);
//# sourceMappingURL=8.fa467ec7.chunk.js.map